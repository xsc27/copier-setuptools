[tox]
envlist =
    py
    lint
    pkg
skip_missing_interpreters = false
minversion = 3.7.0

[testenv]
description = Run Tests
passenv =
    CI
    DOCKER_*
    HOME
    JUNIT_*
    PODMAN_*
    PYTEST_*
    SKIP_*
    SSH_AUTH_SOCK
    TERM
    XDG_*
setenv =
basepython = python3
deps =
    -rrequirements/test.txt
commands =
    pytest {posargs:test}
package = wheel

[testenv:lint]
description = Static Analysis
usedevelop = true
deps =
    -rrequirements/lint.txt
commands =
    flake8 --verbose tests
    pylint --recursive=true tests
    bandit -rc pyproject.toml tests

[testenv:pkg]
description = Check Distribution Package
skip_install = true
deps =
    build
    pyroma
    readme_renderer[md]
    twine
commands =
    pyroma .
    twine check dist/*
commands_pre =
    pyproject-build --wheel --outdir dist .

[testenv:docs]
description = Build Documentation
passenv =
    *
usedevelop = true
deps =
    -rrequirements/docs.txt
commands =
    mkdocs {posargs:build}

[testenv:pin]
description = Pin Dependencies
skip_install = true
deps =
    pip-tools
commands =
    mkdir -p requirements
    pip-compile --resolver=backtracking --generate-hashes --upgrade --output-file=requirements/requirements.txt pyproject.toml
    sh -c " \
      for EXTRA in docs lint test; do \
      cp {toxinidir}/requirements/requirements.txt requirements/$EXTRA.txt ; \
      pip-compile --resolver=backtracking --extra=$EXTRA --generate-hashes --reuse-hashes --output-file=requirements/$EXTRA.txt pyproject.toml ; \
      done \
      "
allowlist_externals =
    sh
    mkdir

[flake8]
max-line-length = 98
extend-ignore =
    D105, # Missing docstring in magic method
